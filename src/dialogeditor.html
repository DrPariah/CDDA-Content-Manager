<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Cataclysm: Dark Days Ahead content manager</title>
		<link rel="stylesheet" href="index.css">
	</head>
	 <script src="filesystemfunctions.js"></script> 
	 <script src="jsonfunctions.js"></script> 
	 <script src="commonclasses.js"></script> 
	 <script src="constants.js"></script> 
	 <script src="dialog_topic_conditions.js"></script> 
	 <script src="htmlfunctions.js"></script> 
	<script>
		//List of all talk topics
		var talk_topics;
		var talk_responses;
		var npcObjList;
		
		//When the page finishes loading
		document.addEventListener("DOMContentLoaded", function(event) {
			init();
		});
		
		//This class represents one talk topic.
		class Talk_topic {
			// jsonObject must be a list of the json object and the path of the file i.e. [[jsonobject], "c:\apps\topics.json"]
			constructor(jsonObject) {
				this.jsonObject = jsonObject;
			}
			
			get id(){
				return this.jsonObject[0].id;
			}
			
			get filePath(){
				return this.jsonObject[1];
			}
			
			//Returns wether or not this talk topic has the specified ID.
			//Some talk topics have multiple IDs. If the given ID is present in the list of IDs, true is returned
			hasID(strID){
				if(typeof this.id == "string") {
					return this.id == strID;
				} else if(Array.isArray(this.id)) {
					return this.id.includes(strID);
				}
				return false;
			}
			
			get htmlTable(){
				let span = document.createElement("span");
				let htmlString = "<table class='talk_topic'>"
				var obj = {talk_topidID: this.id};
				htmlString += buildRecursiveHtmlRowsFromJSON(this.jsonObject[0], JSON.stringify(obj));
				htmlString += "</table>"
				span.innerHTML = htmlString;
				this.updateResponses(span);
				return span;
			}
			
			//Save the tbody element of the responses to a array
			updateResponses(span){
				let responsesTexts = span.getElementsByClassName("trtext");
				let responsesText;
				let responsesTextParent;
				let response
				this.responses = [];
				for (i = 0; i < responsesTexts.length; i++) {
					responsesText = responsesTexts[i];
					responsesTextParent = responsesText.parentElement;
					response = new Talk_response(this, responsesTextParent);
					this.responses.push(response); //Add to this talk_topic's responses array
					talk_responses.push(response); //Add to the global responses array
				}
			}
		}
		
		//This class represents one talk response.
		class Talk_response {
			constructor(talktopic, htmlElement) {
				this.talk_topic = talktopic; //The talk_topic is the parent talk topic of this response
				this.tbody = htmlElement; //A html tbody element with the response in it.
			}
			
			setVisibility(visible){
				if(visible){ 
					this.tbody.style.display = "";
				} else {
					this.tbody.style.display = "none";
				}
			}
			
			//If the condition is true, this response is visible.
			updateVisibility(visible){
				this.setVisibility(this.evaluateCondition())
			}
			
			//If this response has a condition, this function will resolve the condition and return true or false.
			evaluateCondition(){
				let children = this.tbody.getElementsByClassName("tablecondition");
				let htmlElement;
				if(children.length > 0){ //most of the time a response has a condition table and html element will be the first row in that
					htmlElement = children[0].childNodes[0].childNodes[0]; //children[0] = the table, .childNodes[0] = tbody, .childNodes[0] = table row
				} else { //sometimes there is no tablecondition. this is when there's only a condition and it's a simple boolean without value.
					htmlElement = this.tbody.getElementsByClassName("trcondition")[0];
				}
				if(htmlElement){
					//The we send in a table row and it must return true/false. It could be a condition row, an or row, an and row or a not row.
					return this.evaluateConditionRecursive(htmlElement);
				} else {
					//This response does not have a condition. Should always be visible
					return true;
				}
			}
			
			//Recursively try to resolve the condition and return true or false
			evaluateConditionRecursive(htmlElement){
				if(!htmlElement){
					console.log("no htmlElement");
				}
				if(!htmlElement.className){
					console.log("no classname");
				}
				let className = htmlElement.className
				let childNodes;
				let i = 0;
				let node;
				let child;
				let result;
				switch (className) {
					case 'trand': 
					//It's an and
						//Dig down into all the rows in the and subtable. the amount of row can by anywhere between 1 and x;
						childNodes = htmlElement.childNodes[1].childNodes[0].childNodes[0].childNodes;
						result = true;
						for (i = 0; i < childNodes.length; i++) {
							//and and or are always followed by a list of conditions. we have to dig deeper to get those conditions out of the list.
							node = childNodes[i];	//TR of one of the conditions below the and
							child = node.childNodes[1]; //Eighter a table for a condition or a td with a condition;
							if(child.childNodes.length > 0){
								//It has children so it's probably a TR
								if(!this.evaluateConditionRecursive(child.childNodes[0].childNodes[0].childNodes[0])){
									//The row in the and returned as false;
									result = false;
									break; //If any row in the and returns as false, the and is false.
								}
							} else {
								//It has no children. It is a td element
								if(!isToggleConditionChecked(child.textContent)){
									//The row in the and returned as false;
									result = false;
									break; //If any row in the and returns as false, the and is false.
								}
							}
						}
						return result;
					break;

					case 'tror': 
					//It's an or
						//Dig down into all the rows in the and subtable. the amount of row can by anywhere between 1 and x;
						childNodes = htmlElement.childNodes[1].childNodes[0].childNodes[0].childNodes;
						result = false;
						for (i = 0; i < childNodes.length; i++) {
							//and and or are always followed by a list of conditions. we have to dig deeper to get those conditions out of the list.
							node = childNodes[i];	//TR of one of the conditions below the and
							child = node.childNodes[1]; //Eighter a table for a condition or a td with a condition;
							if(child.childNodes.length > 0){
								//It has children so it's probably a TR
								if(this.evaluateConditionRecursive(child.childNodes[0].childNodes[0].childNodes[0])){
									//The row in the or returned as false;
									result = true;
									break; //If any row in the or returns as false, the or is true.
								}
							} else {
								//It has no children. It is a td element
								if(isToggleConditionChecked(child.textContent)){
									//The row in the or returned as false;
									result = true;
									break; //If any row in the or returns as false, the or is true.
								}
							}
						}
						return result;
					break;

					case 'trnot': 
					//It's a not 
						//A not can only have 1 row in its subtable that's why we get the childnodes[0].
						node = htmlElement.childNodes[1].childNodes[0].childNodes[0].childNodes[0];
						return(!this.evaluateConditionRecursive(node)); //use the ! to flip the result of the evaluation.
					break;
					
					case 'trcondition': 
					//It's a condition row. This can happen when there is only one condition and it's a simple boolean with no value like has_many_missions
						//In this case the second cell in the row has a innerText with the name of the condition. return if the condition is checked.
						node = htmlElement.childNodes[1];
						return isToggleConditionChecked(node.textContent)
					break;
					
					default: 
						//Check if it is a condition. in this case we want to check the id which holds the actual condition name
						let topic_condition = getTopic_ConditionJsonByID(htmlElement.id);
						if(topic_condition){ 
							//it's a condition.
							return isToggleConditionChecked(htmlElement.childNodes[1].id + htmlElement.childNodes[1].textContent)
						} else {
							//It's something else.
							return false;
						}
				}
			}
		}
		
		//Initialize function, it is asynchonous to allow await-ing for the functions called in init.
		async function init(){
			npcObjList = new jsonObjList(document.getElementById("npcList"), DATA_JSON_NPCS, "id");
			readTalkTopicsFromDisk();
		}
		
		
		//returns if the given condition is marked at the top of the page.
		function isToggleConditionChecked(conditionName){
			let element = document.getElementById(conditionName);
				if(element){
					if(element.checked){
						return true;
					}
				}
			return false;
		}
		
		<!-- //returns if the given condition is marked at the top of the page. -->
		<!-- function isToggleConditionChecked(conditionName){ -->
			<!-- let elements = document.getElementsByClassName("conditiontrue"); -->
			<!-- let element; -->
			<!-- let elementConditionName; -->
			<!-- for (i = 0; i < elements.length; i++) { -->
				<!-- element = elements[i].childNodes[0]; -->
				<!-- elementConditionName = element.className; -->
				<!-- if(elementConditionName == "condition"){ //This is the case if a condition is a simple boolean without value -->
					<!-- elementConditionName = element.name; -->
				<!-- } -->
				<!-- if(elementConditionName == conditionName){ -->
					<!-- if(element.checked){ -->
						<!-- return true; -->
					<!-- } -->
				<!-- } -->
			<!-- } -->
			<!-- return false; -->
		<!-- } -->
		
		//Checks if the collapsed checkbox is checked and collapses everything but 'text' rows
		function updateCollapsed(){
			let elements = document.getElementsByClassName("text");
			let checked = !document.getElementById('collapsed').checked; //reverse boolean, elements should be visible if it's unchecked
			let siblings;
			let element;
			let sibling;
			for (i = 0; i < elements.length; i++) {
				element = elements[i];
				if(element.tagName == "TR"){
					siblings = element.parentElement.childNodes;
					setElementVisibilityExceptClassName("text", siblings, checked);
				}
			}
		}
		
		function toggleCollapsed(element){
			var siblings = element.parentElement.childNodes;
			for (y = 0; y < siblings.length; y++) {
				var sibling = siblings[y];
				if(sibling.id != "text"){
					if (sibling.style.display != "none") {
						sibling.style.display = "none";
					} else {
						sibling.style.display = "";
					}
				}
			}
		}
		
		//This function will transform the visible dialog and show the content as though the conditions apply
		function updateTopicConditions(){
			let conditionTDElements = getConditionTDElements(); //Get all table conditionTDElement cells
			let conditionName = "";
			let conditionChecked = false;
			let conditionTDElement;
			let conditionTDElementTextContent;
			let conditionTDElementParent;
			let siblings;
			let i = 0;
			//Check that the user has selected the option to view the topic as thought the conditions apply
			if(document.getElementById("conditionsTrueEnabled").checked){
				for (i = 0; i < conditionTDElements.length; i++) {
					conditionTDElement = conditionTDElements[i];
					conditionName = conditionTDElement.id;
					conditionTDElementTextContent = conditionTDElement.textContent;
					if(conditionName == "condition"){ //This happens when a condition is a simple boolean without value,like has_many_missions
						conditionName = conditionTDElementTextContent;
					}
					if(conditionTDElementTextContent != "true" && conditionTDElementTextContent != "false"){
						conditionName += conditionTDElementTextContent; //all toggle conditions are identified by the id and textcontent.
					}
					conditionChecked = isToggleConditionChecked(conditionName);
					conditionTDElementParent = conditionTDElement.parentElement;
					siblings = getHTMLSiblingsByClassName("no", conditionTDElementParent); //Try finding a sibling of 'no'
					if(siblings.length == 1){	//We need exactly one 'no' sibling
						siblings = conditionTDElementParent.parentElement.childNodes;
						if(conditionChecked){
							//The condition is set to true by the user.
							//If there are less then 3 siblings, there is no room for a 'yes', only the condition name and 'no' are present.
							if(siblings.length < 3){
								setElementVisibilityExceptClassName(conditionName, siblings, false); //Everything but the row with the condition is hidden
							} else {
								setElementVisibilityExceptClassName("yes", siblings, false); //Everything but the row with 'yes' is hidden.
							}
						} else {
							setElementVisibilityExceptClassName("no", siblings, false); //Everything but the row with 'no' is hidden.
						}
					}
				}
				let x = 0;
				for (x = 0; x < talk_responses.length; x++) {
					talk_responses[x].updateVisibility();
				}
			} else {
				//The view should be normal. Make everything visible.
				for (i = 0; i < conditionTDElements.length; i++) {
					conditionTDElement = conditionTDElements[i];
					conditionTDElementParent = conditionTDElement.parentElement;
					siblings = getHTMLSiblingsByClassName("no", conditionTDElementParent); //Try finding a sibling of 'no'
					if(siblings.length == 1){	//We need exactly one 'no' sibling
						siblings = conditionTDElementParent.parentElement.childNodes;
						setElementVisibilityExceptClassName("no", siblings, true);
						conditionTDElementParent.parentElement.style.display = "";
					} else {
						//This condition does not have a 'no' sibling. apply the filter some other way
						siblings = conditionTDElementParent.parentElement.childNodes;
						let y = 0;
						//The base element is a TD cell with a condition classname
						//We like to move up the hirargy to find the tr with the 'condition' classname
						for (y = 0; y < 10; y++) {
							if(conditionTDElementParent.id == "condition" && conditionTDElementParent.tagName == "TR"){
								//We have reached the row where the condition is. show everything
								conditionTDElementParent.parentElement.style.display = "";
								break;
							} else {
								conditionTDElementParent = conditionTDElementParent.parentElement;
							}
						}
					}
				}
			}
		}
		
		function conditionBox_click(){
			updateTopicConditions()
		}
		
		function conditionsTrueEnabled_click(){
			updateTopicConditions()
		}
		
		//This function returns a list of td elements that have a condition as classname
		function getConditionTDElements(){
			let cells = document.getElementsByTagName("TD"); //Get all table cells
			let className = ""
			let cell;
			let topic_condition;
			let conditionsList = [];
			let textcontent = "";
			let i=0;
			for (i = 0; i < cells.length; i++) {
				cell = cells[i];
				className = cell.id
				if(className){
					textcontent = cell.textContent;
					if(className != textcontent){ //The textcontent should be the condition value. not the condition name
						//Some conditions are siple booleans and do not have values.
						//This creates an element with classname=condition and textContent=varname for example u_has_weapon
						if(className == "condition"){ //In this case we replace the classname with the textContent
							className = cell.textContent; //In this case, it becomes u_has_weapon, which is a condition so the cell counts as a condition
						}
						//Check if it is a condition
						topic_condition = getTopic_ConditionJsonByID(className);
						if(topic_condition){ 
							conditionsList.push(cell); 
						}
					}
				}
			}
			return conditionsList;
		}
		
		//This function returns a JSON element of a condition if provide with an id.
		function getTopic_ConditionJsonByID(id){
			let topic_condition;
			let conditionName = "";
			let y=0;
			//topic_conditions is a global constant defined in dialog_topic_conditions.js
			for (y = 0; y < topic_conditions.length; y++) {
				topic_condition = topic_conditions[y];
				conditionName = topic_condition.condition;
				if(id == conditionName){
					return topic_condition;
				}
			}
			return false;
		}
		
		
		//Lists all the conditions on the page at the top
		async function updateToggleConditions(){
			var cells = getConditionTDElements(); //Get all table condition cells
			var className = ""
			var cellContents = ""
			var cell;
			var topic_condition;
			var isInList;
			var conditionsList = [];
			let conditionDatatype = "";
			let i=0;
			for (i = 0; i < cells.length; i++) {
				cell = cells[i];
				className = cell.id;
				cellContents = cell.textContent;
				if(className == "condition"){
					className = cellContents;
				}
				topic_condition = getTopic_ConditionJsonByID(className);
				conditionDatatype = topic_condition.datatype;
				isInList = false;
				//Check if it is already in the list
				for (x = 0; x < conditionsList.length; x++) {
					//Check if the classname matches a classname entered before;
					if(className == conditionsList[x][0]){
						if(conditionDatatype == "boolean"){
							isInList = true;
						} else {
							//string conditions may appear multiple times as long as their strings are different i.e. npc_has_var can have differen variable names.
							if(cellContents == conditionsList[x][1]){
								isInList = true;
							}
						}
					}
				}
				if(!isInList){
					//If it's a boolean we don't want the string following it. instead just put 'boolean'.
					if(conditionDatatype == "boolean"){
						conditionsList.push([className, ""]);
					} else {
						//It's something other then a boolean, put whatever is following the condition.
						conditionsList.push([className, cellContents]);
					}
				}
			}
			
			//Now transform the obtained conditions into HTML to be used by the user.
			var htmlString = ""
			document.getElementById("conditionsToggle").innerHTML = "";
			i=0;
			let conditionName = "";
			let conditionValue = "";
			for (i = 0; i < conditionsList.length; i++) {
				topic_condition = conditionsList[i];
				conditionName = topic_condition[0];
				conditionValue = topic_condition[1];
				htmlString += ' | <span class="conditiontrue"><input type="checkbox" '
				htmlString += 'id="'+conditionName+conditionValue+'" '
				<!-- htmlString += 'value="'+conditionName+'" ' -->
				<!-- htmlString += 'name="'+conditionValue+'" ' -->
				htmlString += 'onclick="conditionBox_click()">'
				if(conditionValue){
					htmlString += conditionName+': '+conditionValue;
				} else {
					htmlString += conditionName;
				}
				htmlString += '</span>'
			}
			if(htmlString == ""){
				document.getElementById("conditionsTrueContainer").style.display = "none";
			} else {
				document.getElementById("conditionsTrueContainer").style.display = "";
			}
			document.getElementById("conditionsToggle").innerHTML = htmlString;
		}
		
		
		//Takes a topic and display its content to the user in HTML tables
		//The previousTopic is the topic the user saw before navigating to the current topic.
		//The previousTopic allows the user to return to the topic he was seeing before.
		function displayTalkTopic(previousTopic, currentTopic){
			document.getElementById("npcTalkTree").innerHTML = "";
			document.getElementById("previousTopic").innerHTML = previousTopic;
			document.getElementById("previousTopic").onclick = function(){displayTalkTopic(currentTopic, previousTopic)};
			var talk_topics = getTalkTopicsById(currentTopic);
			talk_responses = [];
			
			if(currentTopic != "TALK_DONE"){
				let i=0;
				for (i = 0; i < talk_topics.length; i++) {
					document.getElementById("npcTalkTree").appendChild(talk_topics[i].htmlTable);
					updateTopicElementClick();
					updateTextElementClick();
					updateCollapsed();
					updateToggleConditions();
					updateTopicConditions();
				}
			} else {
				document.getElementById("npcTalkTree").innerHTML = createTALK_DONE_NONEhtmlTable("TALK_DONE", "");
				document.getElementById("conditionsToggle").innerHTML = "";
				document.getElementById("conditionsTrueContainer").style.display = "none";
			}
		}
		
		//A topic can be clicked to view it (it replaces the currently viewed topic)
		function updateTopicElementClick(){
			var elements = document.getElementsByClassName("tdtopic");
			for (i = 0; i < elements.length; i++) {
				var element = elements[i];
				let data = JSON.parse(element.title);
				let previousTopic = data.talk_topidID;
				let currentTopic = element.innerHTML
				element.onclick = function(){displayTalkTopic(previousTopic, currentTopic)};
			}
		}
		
		//A text can be clicked to toggle collapsed view
		function updateTextElementClick(){
			var elements = document.getElementsByClassName("text");
			for (i = 0; i < elements.length; i++) {
				var element = elements[i];
				if(element.tagName == "TR"){
					element.onclick = function(){toggleCollapsed(this)};
				}
			}
		}
		
		
		
		//When the user selects an item from the NPC list
		async function npcList_change(selectElement){
			//User selects an item
			//Get item title (it's a json string)
			let itemTitle = selectElement.options[selectElement.selectedIndex].title;
			//Transform the title string to a json object
			var jsonObj = JSON.parse(itemTitle);  
			//Transform the json object to html
			let htmlString = buildHtmlTableFromJSON_andFile(jsonObj);
			//Update the npc basic properties element
			document.getElementById("npcBasicProperties").innerHTML = htmlString
			
			var chat = jsonObj[0].chat;
			displayTalkTopic(chat, chat);
		}
		
		//Create custom talk topic html table for TALK_DONE
		function createTALK_DONE_NONEhtmlTable(str, text){
			let htmlString = "<table>";
			htmlString += "<tr><td>type</td><td>talk_topic</td></tr>";
			htmlString += "<tr><td>id</td><td>"+str+"</td></tr>";
			if(text){htmlString += "<tr><td>id</td><td>"+text+"</td></tr>"};
			htmlString += "</table>";
			return htmlString;
		}
		
		//Get a talk topics by ID. Some talk topics have multiple id's if one id appears in multiple talk topics, return all of them.
		function getTalkTopicsById(strID){
			var i;
			var talk_topicID;
			var talkTopicList = []
			for (i = 0; i < talk_topics.length; i++) {
				talk_topicID = talk_topics[i];
				if(talk_topicID.hasID(strID)){
					talkTopicList.push(talk_topics[i]);
				}
			}
			return talkTopicList;
		}
		
		//Get a single talk topic by ID. Will only get the first topic that matches the given ID fully.
		function getTalkTopicById(strID){
			var i;
			var talk_topicID;
			for (i = 0; i < talk_topics.length; i++) {
				if(talk_topics[i].id == strID){
					return talk_topics[i];
				}
			}
			return false;
		}
		
		
		function collapsed_click(element){
			updateCollapsed();
		}
		
		
		
		
		//Updates the list of all talk topics
		async function readTalkTopicsFromDisk(){
			//Update variable talk topics to contain all talk topics
			allTopics = await getFilteredJsonItemsFromFolder(DATA_JSON_NPCS, [["type", "talk_topic", true, true]]);
			talk_topics = [];
			for (i = 0; i < allTopics.length; i++) {
				var talk_topic = new Talk_topic(allTopics[i]);
				talk_topics.push(talk_topic);
			}
		}
		
		
		
		<!-- //The first iteration akes a html row with classname condition and evaluates to true/false -->
		<!-- function recursiveEvaluateCondition(conditionElement){ -->
			<!-- let childNodes = conditionElement.childNodes; -->
			<!-- let className; -->
			<!-- let tagName; -->
			<!-- if(childNodes){ -->
				<!-- let childNode; -->
				<!-- //Check that the first child contains condition so we can make sure we don't have the wrong row -->
				<!-- if(childNodes[0].textContent == "condition"){	//This is only true at the top-level -->
					
				<!-- } else { //We are in a sub-level of the iteration -->
					<!-- let numberOfChildren = childNodes.length; -->
					<!-- let y = 0; -->
					<!-- for (y = 0; y < numberOfChildren; y++) { -->
						<!-- childNode = childNodes[y]; -->
						<!-- className = childNode.id; -->
						<!-- tagName = childNode.tagName; -->
						<!-- switch (className) { -->
							<!-- case 'and':  -->
							<!-- //It's an and -->
							<!-- break; -->

							<!-- case 'or':  -->
							<!-- //It's an or -->
								
							<!-- break; -->

							<!-- case 'not':  -->
							<!-- //It's a not -->
							<!-- break; -->
							
							<!-- default:  -->
								<!-- if(className == "condition"){ //In this case we replace the classname with the textContent -->
									<!-- className = cell.textContent; //In this case, it becomes u_has_weapon, which is a condition so the cell counts as a condition -->
								<!-- } -->
								<!-- //Check if it is a condition -->
								<!-- topic_condition = getTopic_ConditionJsonByID(className); -->
								<!-- if(topic_condition){  -->
									<!-- //it's a condition. it has childnodes -->
									<!-- if(recursiveEvaluateCondition(conditionElement)){ //true has been returned -->
									
									<!-- } else { //false has been returned -->
									
									<!-- } -->
								<!-- } else { -->
									<!-- //It's something else. It has children. -->
									<!-- return recursiveEvaluateCondition(conditionElement); //This has a possibility of returning true. -->
								<!-- } -->
						<!-- } -->
					<!-- } -->
				<!-- } -->
			<!-- } else { //There are no more children, this is the last child. -->
				<!-- className = conditionElement.id -->
				<!-- if(className == "condition"){ //In this case we replace the classname with the textContent -->
					<!-- className = cell.textContent; //In this case, it becomes u_has_weapon, which is a condition so the cell counts as a condition -->
				<!-- } -->
				<!-- //Check if it is a condition -->
				<!-- topic_condition = getTopic_ConditionJsonByID(className); -->
				<!-- if(topic_condition){  -->
					<!-- //it's a condition -->
					<!-- let conditionChecked = isToggleConditionChecked(className); -->
					<!-- if(conditionChecked){ //It's a condition and the user say's it's true, so return true. -->
						<!-- return true; -->
					<!-- } -->
				<!-- } else { -->
					<!-- //It's something else.  -->
					<!-- //It's probably nothing interesting and we should do nothing. -->
				<!-- } -->
			<!-- } -->
		<!-- } -->
		
		
		 <!-- else { -->
						<!-- //This condition does not have a 'no' sibling. apply the filter some other way -->
						<!-- let y = 0; -->
						<!-- let className; -->
						<!-- let not = false; -->
						<!-- //The base element is a TD cell with a condition classname -->
						<!-- //We like to move up the hirargy to find the tr with the 'condition' classname -->
						<!-- //If we encounter a row with 'not', take that into account -->
						<!-- for (y = 0; y < 10; y++) { -->
							<!-- className = conditionTDElementParent.id; -->
							<!-- if(className == "condition" && conditionTDElementParent.tagName == "TR"){ -->
								<!-- //We have reached the row where the condition is. -->
								<!-- //We hide the whole table if the condition does not match. -->
								<!-- if(conditionChecked){ -->
									<!-- //The condition is true -->
									<!-- if(not){ -->
										<!-- conditionTDElementParent.parentElement.style.display = "none"; -->
									<!-- } else { -->
										<!-- conditionTDElementParent.parentElement.style.display = ""; -->
									<!-- } -->
								<!-- } else { -->
									<!-- //The condition is false -->
									<!-- if(not){ -->
										<!-- conditionTDElementParent.parentElement.style.display = ""; -->
									<!-- } else { -->
										<!-- conditionTDElementParent.parentElement.style.display = "none"; -->
									<!-- } -->
								<!-- } -->
								<!-- break; -->
							<!-- } else { -->
								<!-- //Check if it is contained within a 'not' -->
								<!-- if(className == "not" && conditionTDElementParent.tagName == "TR"){ -->
									<!-- not = true; -->
								<!-- } -->
								<!-- conditionTDElementParent = conditionTDElementParent.parentElement; -->
							<!-- } -->
						<!-- } -->
					<!-- } -->
		
	</script> 
		<body>
		<h1>Cataclysm: Dark Days Ahead dialog editor</h1>
		<p>Welcome to the content manager of Cataclysm: Dark Days Ahead. <a href="index.html">back to home</a></p>
		<div class="mainContent">
		<table>
		<tr>
			<td>
				<p>List of NPCs:</p>
				<p id="listNPCsContainer">
					<select name="npcList" id="npcList"  onchange="npcList_change(this);" size="42">
					</select>
				</p>
			</td>
			<td>
				<div class="contentContainer">
					<p id="npcBasicProperties">Select a NPC to start.</p>
					<p><b><span>Previous topic: </span><span id="previousTopic"></span></b></p>
					<p><input type="checkbox" id="collapsed" onclick="collapsed_click(this)" title="show dialog content collapsed" name="collapsed" value="collapsed">collapsed</p>
					<p class="conditionsTrueContainer" id="conditionsTrueContainer" style="display:none">
						<input type="checkbox" id="conditionsTrueEnabled" onclick="conditionsTrueEnabled_click()" title="Checking this box will show the dialog as though the conditions were true/false. You can mark each condition as true or false by checking or unchecking each condition's box." name="conditionsTrueEnabled" value="conditionsTrueEnabled">
						<span>Conditions true: </span><span id="conditionsToggle"></span>
					</p>
					<p id="npcTalkTree"></p>
				</div>
			</td>
		</tr>
		</div>
		</table>
		
		
	</body>
</html>
